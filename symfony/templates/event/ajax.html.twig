{% if events %}
{% import "macros/lists.html.twig" as lists %}
{% for key, event in events %}
{% if event.duration <= 1 %}
<div class="event {% for category in event.categories %}category-{{ category.id }} {% endfor %}" style="left: {{ attribute(positions, key) }}px;">
    <div class="event-content">
        <div class="collapse btn-group small" id="collapse-event-{{ key }}">
            <button type="button" class="btn btn-link btn-sm btn-modal" data-bs-toggle="modal" data-bs-target="#modal-event-{{ key }}">
                <i class="fas fa-info-circle" data-bs-toggle="popover" title="Voir plus"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-hide">
                <i class="fas fa-eye-slash" data-bs-toggle="popover" title="Masquer"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-up disabled">
                <i class="fas fa-level-up-alt" data-bs-toggle="popover" title="Monter"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-down disabled">
                <i class="fas fa-level-down-alt" data-bs-toggle="popover" title="Descendre"></i>
            </button>
        </div>
        {{ event.name }}
        <button type="button" class="btn btn-sm btn-link" data-bs-toggle="collapse" data-bs-target="#collapse-event-{{ key }}" aria-expanded="false" aria-controls="collapse-event-{{ key }}">
            <i class="fas fa-plus-circle"></i>
        </button>
    </div>
</div>
{% else %}
<div class="longevent {% for category in event.categories %}category-{{ category.id }} {% endfor %}" style="left: {{ attribute(positions, key) }}px;width: {{ event.duration / ratio }}px;">
    <div class="longevent-content">
        <div class="collapse btn-group small" id="collapse-event-{{ key }}">
            <button type="button" class="btn btn-link btn-sm btn-modal" data-bs-toggle="modal" data-bs-target="#modal-event-{{ key }}">
                <i class="fas fa-info-circle" data-bs-toggle="popover" title="Voir plus"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-hide">
                <i class="fas fa-eye-slash" data-bs-toggle="popover" title="Masquer"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-up disabled">
                <i class="fas fa-level-up-alt" data-bs-toggle="popover" title="Monter"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm btn-down disabled">
                <i class="fas fa-level-down-alt" data-bs-toggle="popover" title="Descendre"></i>
            </button>
        </div>
        {{ event.name }}
        <button type="button" class="btn btn-sm btn-link" data-bs-toggle="collapse" data-bs-target="#collapse-event-{{ key }}" aria-expanded="false" aria-controls="collapse-event-{{ key }}">
            <i class="fas fa-plus-circle"></i>
        </button>
    </div>
</div>
{% endif %}
<!-- Hidden Modal -->
<div class="modal fade" id="modal-event-{{ key }}" tabindex="-1" aria-labelledby="{{ key }}Label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ key }}Label">
                    {{ event.name }} - <small class="text-muted">{{ event.duration }} an(s)</small>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <img src="{{ event.imageFilename ? asset('uploads/images/' ~ event.imageFilename) : asset('build/blank_image.jpg') }}" alt="{{ event.imageFilename }}" class="img-fluid">
            <div class="modal-body">
                <small class="text-muted">
                    ({{ (event.start.accuracy < 100) ? 'env. ' : '' }}
                    {% if event.duration > 1 %}
                    {{ event.start.year }} {{ event.start.BC ? 'avant n.è.' : '' }} - {{ (event.end.accuracy < 100) ? 'env. ' : '' }}{{ event.end.year }} {{ event.end.BC ? 'avant n.è.' : '' }}
                    {% else %}
                    {{ event.start.year }} {{ event.start.BC ? 'avant n.è.' : '' }}
                    {% endif %})
                </small>
                <p class="mt-3">{{ event.description|u.truncate(100, '...') }}</p>
                {{ lists.sources(event) }}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}
